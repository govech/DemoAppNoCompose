# 🎨 主题系统使用指南

## 📋 概述

本指南详细介绍了如何在DemoAppNoCompose项目中使用主题配色系统，包括基本用法、高级功能、最佳实践等。适合开发者和设计师参考。

## 🚀 快速开始

### 1. 基本使用

#### 在XML布局中使用主题颜色

```xml
<!-- 使用主题属性（推荐） -->
<TextView
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="Hello World"
    android:textColor="?attr/textColorPrimary"
    android:background="?attr/colorSurface" />

<!-- 使用具体颜色（不推荐） -->
<TextView
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="Hello World"
    android:textColor="@color/default_primary"
    android:background="@color/default_surface" />
```

#### 在代码中使用主题颜色

```kotlin
// 使用扩展函数（推荐）
val primaryColor = context.getPrimaryColor()
val textColor = context.getTextPrimaryColor()
val backgroundColor = context.getBackgroundColor()

// 使用ThemeManager
val primaryColor = themeManager.getThemeColor(context, R.attr.colorPrimary)
```

### 2. 创建支持主题的Activity

```kotlin
@AndroidEntryPoint
class MyActivity : BaseActivity<ActivityMyBinding>() {
    
    override val bindingInflater = ActivityMyBinding::inflate
    
    @Inject
    lateinit var injectedThemeManager: ThemeManager
    
    override fun initView() {
        // 初始化BaseActivity的themeManager
        super.themeManager = injectedThemeManager
        
        // 其他初始化代码...
    }
}
```

## 🎨 主题颜色使用

### 1. 主要颜色

#### 主色 (Primary Color)
```kotlin
// 获取主色
val primaryColor = context.getPrimaryColor()

// 在XML中使用
android:background="?attr/colorPrimary"
android:textColor="?attr/colorOnPrimary"
```

#### 次色 (Secondary Color)
```kotlin
// 获取次色
val secondaryColor = context.getSecondaryColor()

// 在XML中使用
android:background="?attr/colorSecondary"
android:textColor="?attr/colorOnSecondary"
```

### 2. 背景颜色

#### 页面背景
```kotlin
// 获取背景色
val backgroundColor = context.getBackgroundColor()

// 在XML中使用
android:background="?attr/colorBackground"
```

#### 表面颜色
```kotlin
// 获取表面色
val surfaceColor = context.getSurfaceColor()

// 在XML中使用
android:background="?attr/colorSurface"
```

### 3. 文本颜色

#### 主要文本
```kotlin
// 获取主要文本色
val textPrimaryColor = context.getTextPrimaryColor()

// 在XML中使用
android:textColor="?attr/textColorPrimary"
```

#### 次要文本
```kotlin
// 获取次要文本色
val textSecondaryColor = context.getTextSecondaryColor()

// 在XML中使用
android:textColor="?attr/textColorSecondary"
```

### 4. 功能颜色

#### 错误色
```kotlin
// 获取错误色
val errorColor = context.getErrorColor()

// 在XML中使用
android:textColor="?attr/colorError"
```

#### 成功色
```kotlin
// 获取成功色
val successColor = context.getSuccessColor()

// 在XML中使用
android:textColor="?attr/colorSuccess"
```

## 🛠️ 高级功能

### 1. 主题切换

#### 在代码中切换主题
```kotlin
// 切换到默认主题
lifecycleScope.launch {
    themeManager.switchTheme(AppTheme.DEFAULT)
}

// 切换到商务主题
lifecycleScope.launch {
    themeManager.switchTheme(AppTheme.BUSINESS)
}

// 切换到活力主题
lifecycleScope.launch {
    themeManager.switchTheme(AppTheme.VIBRANT)
}
```

#### 监听主题变化
```kotlin
lifecycleScope.launch {
    themeManager.getCurrentThemeConfig().collect { themeConfig ->
        // 处理主题变化
        updateUI(themeConfig)
    }
}
```

### 2. 暗黑模式管理

#### 切换暗黑模式
```kotlin
// 启用暗黑模式
lifecycleScope.launch {
    themeManager.switchDarkMode(true)
}

// 禁用暗黑模式
lifecycleScope.launch {
    themeManager.switchDarkMode(false)
}
```

#### 跟随系统设置
```kotlin
// 启用跟随系统
lifecycleScope.launch {
    themeManager.setFollowSystem(true)
}

// 禁用跟随系统
lifecycleScope.launch {
    themeManager.setFollowSystem(false)
}
```

### 3. 颜色工具函数

#### 调整颜色透明度
```kotlin
val primaryColor = context.getPrimaryColor()
val semiTransparentColor = primaryColor.withAlpha(0.5f)
```

#### 颜色加深/减淡
```kotlin
val primaryColor = context.getPrimaryColor()
val darkerColor = primaryColor.darken(0.2f)  // 加深20%
val lighterColor = primaryColor.lighten(0.2f)  // 减淡20%
```

## 🎯 最佳实践

### 1. 布局设计

#### 使用主题属性
```xml
<!-- ✅ 推荐：使用主题属性 -->
<TextView
    android:textColor="?attr/textColorPrimary"
    android:background="?attr/colorSurface" />

<!-- ❌ 不推荐：硬编码颜色 -->
<TextView
    android:textColor="#2196F3"
    android:background="#FFFFFF" />
```

#### 保持颜色层级
```xml
<!-- 主要内容使用主要颜色 -->
<TextView
    android:text="标题"
    android:textColor="?attr/textColorPrimary"
    android:textSize="18sp" />

<!-- 次要内容使用次要颜色 -->
<TextView
    android:text="描述"
    android:textColor="?attr/textColorSecondary"
    android:textSize="14sp" />
```

### 2. 代码组织

#### 使用扩展函数
```kotlin
// ✅ 推荐：使用扩展函数
textView.setThemeTextColor()
imageView.setThemeTint()
view.setThemeBackground()

// ❌ 不推荐：直接设置颜色
textView.setTextColor(context.getTextPrimaryColor())
imageView.setColorFilter(context.getPrimaryColor())
view.setBackgroundColor(context.getSurfaceColor())
```

#### 集中管理颜色
```kotlin
// 创建颜色管理类
object ColorManager {
    fun getButtonColor(context: Context): Int {
        return context.getPrimaryColor()
    }
    
    fun getTextColor(context: Context, isPrimary: Boolean): Int {
        return if (isPrimary) {
            context.getTextPrimaryColor()
        } else {
            context.getTextSecondaryColor()
        }
    }
}
```

### 3. 性能优化

#### 缓存颜色值
```kotlin
class MyActivity : BaseActivity<ActivityMyBinding>() {
    private val primaryColor by lazy { getPrimaryColor() }
    private val textColor by lazy { getTextPrimaryColor() }
    
    override fun initView() {
        // 使用缓存的颜色值
        binding.title.setTextColor(textColor)
        binding.button.setBackgroundColor(primaryColor)
    }
}
```

#### 避免重复计算
```kotlin
// ✅ 推荐：计算一次，多次使用
val primaryColor = context.getPrimaryColor()
button1.setBackgroundColor(primaryColor)
button2.setBackgroundColor(primaryColor)

// ❌ 不推荐：重复计算
button1.setBackgroundColor(context.getPrimaryColor())
button2.setBackgroundColor(context.getPrimaryColor())
```

## 📱 实际应用示例

### 1. 创建主题化按钮

```xml
<!-- 主按钮 -->
<Button
    android:id="@+id/btnPrimary"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="主要按钮"
    android:textColor="?attr/colorOnPrimary"
    android:background="@drawable/bg_button_primary_pressed" />

<!-- 次按钮 -->
<Button
    android:id="@+id/btnSecondary"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="次要按钮"
    android:textColor="?attr/colorOnSecondary"
    android:background="@drawable/bg_secondary_rounded" />
```

### 2. 创建主题化卡片

```xml
<androidx.cardview.CardView
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:background="?attr/colorSurface"
    app:cardCornerRadius="8dp"
    app:cardElevation="2dp">
    
    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="vertical"
        android:padding="16dp">
        
        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="卡片标题"
            android:textColor="?attr/textColorPrimary"
            android:textSize="16sp"
            android:textStyle="bold" />
        
        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_marginTop="8dp"
            android:text="卡片内容"
            android:textColor="?attr/textColorSecondary"
            android:textSize="14sp" />
            
    </LinearLayout>
    
</androidx.cardview.CardView>
```

### 3. 创建主题化输入框

```xml
<com.google.android.material.textfield.TextInputLayout
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:hint="请输入内容"
    app:boxBackgroundColor="?attr/colorSurface"
    app:hintTextColor="?attr/textColorSecondary">
    
    <com.google.android.material.textfield.TextInputEditText
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:textColor="?attr/textColorPrimary"
        android:textColorHint="?attr/textColorTertiary" />
        
</com.google.android.material.textfield.TextInputLayout>
```

## 🔧 常见问题解决

### 1. 主题切换不生效

**问题**: 切换主题后界面没有变化

**解决方案**:
```kotlin
// 确保Activity继承自BaseActivity
class MyActivity : BaseActivity<ActivityMyBinding>() {
    
    // 确保正确注入ThemeManager
    @Inject
    lateinit var injectedThemeManager: ThemeManager
    
    override fun initView() {
        super.themeManager = injectedThemeManager
        // 其他代码...
    }
}
```

### 2. 颜色获取失败

**问题**: 获取主题颜色时返回默认值

**解决方案**:
```kotlin
// 检查ThemeManager是否已初始化
if (::themeManager.isInitialized) {
    val color = themeManager.getThemeColor(context, R.attr.colorPrimary)
} else {
    // 使用默认颜色
    val color = ContextCompat.getColor(context, android.R.color.white)
}
```

### 3. 暗黑模式不跟随系统

**问题**: 设置跟随系统后，暗黑模式没有自动切换

**解决方案**:
```kotlin
// 确保Activity重写了onConfigurationChanged
override fun onConfigurationChanged(newConfig: Configuration) {
    super.onConfigurationChanged(newConfig)
    
    // BaseActivity会自动处理配置变化
    // 如果需要自定义处理，可以重写此方法
}
```

## 📚 扩展阅读

### 相关文档
- [主题系统架构文档](主题系统架构文档.md)
- [颜色规范文档](颜色规范文档.md)
- [Material Design 3 规范](https://m3.material.io/)

### 示例代码
- [ThemeSettingsActivity](../app/src/main/java/lj/sword/demoappnocompose/ui/settings/ThemeSettingsActivity.kt)
- [BaseActivity](../app/src/main/java/lj/sword/demoappnocompose/base/BaseActivity.kt)
- [ColorExt](../app/src/main/java/lj/sword/demoappnocompose/utils/ext/ColorExt.kt)

---

*本文档最后更新时间: 2024年10月*
