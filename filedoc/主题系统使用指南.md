# ğŸ¨ ä¸»é¢˜ç³»ç»Ÿä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»äº†å¦‚ä½•åœ¨DemoAppNoComposeé¡¹ç›®ä¸­ä½¿ç”¨ä¸»é¢˜é…è‰²ç³»ç»Ÿï¼ŒåŒ…æ‹¬åŸºæœ¬ç”¨æ³•ã€é«˜çº§åŠŸèƒ½ã€æœ€ä½³å®è·µç­‰ã€‚é€‚åˆå¼€å‘è€…å’Œè®¾è®¡å¸ˆå‚è€ƒã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åŸºæœ¬ä½¿ç”¨

#### åœ¨XMLå¸ƒå±€ä¸­ä½¿ç”¨ä¸»é¢˜é¢œè‰²

```xml
<!-- ä½¿ç”¨ä¸»é¢˜å±æ€§ï¼ˆæ¨èï¼‰ -->
<TextView
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="Hello World"
    android:textColor="?attr/textColorPrimary"
    android:background="?attr/colorSurface" />

<!-- ä½¿ç”¨å…·ä½“é¢œè‰²ï¼ˆä¸æ¨èï¼‰ -->
<TextView
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="Hello World"
    android:textColor="@color/default_primary"
    android:background="@color/default_surface" />
```

#### åœ¨ä»£ç ä¸­ä½¿ç”¨ä¸»é¢˜é¢œè‰²

```kotlin
// ä½¿ç”¨æ‰©å±•å‡½æ•°ï¼ˆæ¨èï¼‰
val primaryColor = context.getPrimaryColor()
val textColor = context.getTextPrimaryColor()
val backgroundColor = context.getBackgroundColor()

// ä½¿ç”¨ThemeManager
val primaryColor = themeManager.getThemeColor(context, R.attr.colorPrimary)
```

### 2. åˆ›å»ºæ”¯æŒä¸»é¢˜çš„Activity

```kotlin
@AndroidEntryPoint
class MyActivity : BaseActivity<ActivityMyBinding>() {
    
    override val bindingInflater = ActivityMyBinding::inflate
    
    @Inject
    lateinit var injectedThemeManager: ThemeManager
    
    override fun initView() {
        // åˆå§‹åŒ–BaseActivityçš„themeManager
        super.themeManager = injectedThemeManager
        
        // å…¶ä»–åˆå§‹åŒ–ä»£ç ...
    }
}
```

## ğŸ¨ ä¸»é¢˜é¢œè‰²ä½¿ç”¨

### 1. ä¸»è¦é¢œè‰²

#### ä¸»è‰² (Primary Color)
```kotlin
// è·å–ä¸»è‰²
val primaryColor = context.getPrimaryColor()

// åœ¨XMLä¸­ä½¿ç”¨
android:background="?attr/colorPrimary"
android:textColor="?attr/colorOnPrimary"
```

#### æ¬¡è‰² (Secondary Color)
```kotlin
// è·å–æ¬¡è‰²
val secondaryColor = context.getSecondaryColor()

// åœ¨XMLä¸­ä½¿ç”¨
android:background="?attr/colorSecondary"
android:textColor="?attr/colorOnSecondary"
```

### 2. èƒŒæ™¯é¢œè‰²

#### é¡µé¢èƒŒæ™¯
```kotlin
// è·å–èƒŒæ™¯è‰²
val backgroundColor = context.getBackgroundColor()

// åœ¨XMLä¸­ä½¿ç”¨
android:background="?attr/colorBackground"
```

#### è¡¨é¢é¢œè‰²
```kotlin
// è·å–è¡¨é¢è‰²
val surfaceColor = context.getSurfaceColor()

// åœ¨XMLä¸­ä½¿ç”¨
android:background="?attr/colorSurface"
```

### 3. æ–‡æœ¬é¢œè‰²

#### ä¸»è¦æ–‡æœ¬
```kotlin
// è·å–ä¸»è¦æ–‡æœ¬è‰²
val textPrimaryColor = context.getTextPrimaryColor()

// åœ¨XMLä¸­ä½¿ç”¨
android:textColor="?attr/textColorPrimary"
```

#### æ¬¡è¦æ–‡æœ¬
```kotlin
// è·å–æ¬¡è¦æ–‡æœ¬è‰²
val textSecondaryColor = context.getTextSecondaryColor()

// åœ¨XMLä¸­ä½¿ç”¨
android:textColor="?attr/textColorSecondary"
```

### 4. åŠŸèƒ½é¢œè‰²

#### é”™è¯¯è‰²
```kotlin
// è·å–é”™è¯¯è‰²
val errorColor = context.getErrorColor()

// åœ¨XMLä¸­ä½¿ç”¨
android:textColor="?attr/colorError"
```

#### æˆåŠŸè‰²
```kotlin
// è·å–æˆåŠŸè‰²
val successColor = context.getSuccessColor()

// åœ¨XMLä¸­ä½¿ç”¨
android:textColor="?attr/colorSuccess"
```

## ğŸ› ï¸ é«˜çº§åŠŸèƒ½

### 1. ä¸»é¢˜åˆ‡æ¢

#### åœ¨ä»£ç ä¸­åˆ‡æ¢ä¸»é¢˜
```kotlin
// åˆ‡æ¢åˆ°é»˜è®¤ä¸»é¢˜
lifecycleScope.launch {
    themeManager.switchTheme(AppTheme.DEFAULT)
}

// åˆ‡æ¢åˆ°å•†åŠ¡ä¸»é¢˜
lifecycleScope.launch {
    themeManager.switchTheme(AppTheme.BUSINESS)
}

// åˆ‡æ¢åˆ°æ´»åŠ›ä¸»é¢˜
lifecycleScope.launch {
    themeManager.switchTheme(AppTheme.VIBRANT)
}
```

#### ç›‘å¬ä¸»é¢˜å˜åŒ–
```kotlin
lifecycleScope.launch {
    themeManager.getCurrentThemeConfig().collect { themeConfig ->
        // å¤„ç†ä¸»é¢˜å˜åŒ–
        updateUI(themeConfig)
    }
}
```

### 2. æš—é»‘æ¨¡å¼ç®¡ç†

#### åˆ‡æ¢æš—é»‘æ¨¡å¼
```kotlin
// å¯ç”¨æš—é»‘æ¨¡å¼
lifecycleScope.launch {
    themeManager.switchDarkMode(true)
}

// ç¦ç”¨æš—é»‘æ¨¡å¼
lifecycleScope.launch {
    themeManager.switchDarkMode(false)
}
```

#### è·Ÿéšç³»ç»Ÿè®¾ç½®
```kotlin
// å¯ç”¨è·Ÿéšç³»ç»Ÿ
lifecycleScope.launch {
    themeManager.setFollowSystem(true)
}

// ç¦ç”¨è·Ÿéšç³»ç»Ÿ
lifecycleScope.launch {
    themeManager.setFollowSystem(false)
}
```

### 3. é¢œè‰²å·¥å…·å‡½æ•°

#### è°ƒæ•´é¢œè‰²é€æ˜åº¦
```kotlin
val primaryColor = context.getPrimaryColor()
val semiTransparentColor = primaryColor.withAlpha(0.5f)
```

#### é¢œè‰²åŠ æ·±/å‡æ·¡
```kotlin
val primaryColor = context.getPrimaryColor()
val darkerColor = primaryColor.darken(0.2f)  // åŠ æ·±20%
val lighterColor = primaryColor.lighten(0.2f)  // å‡æ·¡20%
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. å¸ƒå±€è®¾è®¡

#### ä½¿ç”¨ä¸»é¢˜å±æ€§
```xml
<!-- âœ… æ¨èï¼šä½¿ç”¨ä¸»é¢˜å±æ€§ -->
<TextView
    android:textColor="?attr/textColorPrimary"
    android:background="?attr/colorSurface" />

<!-- âŒ ä¸æ¨èï¼šç¡¬ç¼–ç é¢œè‰² -->
<TextView
    android:textColor="#2196F3"
    android:background="#FFFFFF" />
```

#### ä¿æŒé¢œè‰²å±‚çº§
```xml
<!-- ä¸»è¦å†…å®¹ä½¿ç”¨ä¸»è¦é¢œè‰² -->
<TextView
    android:text="æ ‡é¢˜"
    android:textColor="?attr/textColorPrimary"
    android:textSize="18sp" />

<!-- æ¬¡è¦å†…å®¹ä½¿ç”¨æ¬¡è¦é¢œè‰² -->
<TextView
    android:text="æè¿°"
    android:textColor="?attr/textColorSecondary"
    android:textSize="14sp" />
```

### 2. ä»£ç ç»„ç»‡

#### ä½¿ç”¨æ‰©å±•å‡½æ•°
```kotlin
// âœ… æ¨èï¼šä½¿ç”¨æ‰©å±•å‡½æ•°
textView.setThemeTextColor()
imageView.setThemeTint()
view.setThemeBackground()

// âŒ ä¸æ¨èï¼šç›´æ¥è®¾ç½®é¢œè‰²
textView.setTextColor(context.getTextPrimaryColor())
imageView.setColorFilter(context.getPrimaryColor())
view.setBackgroundColor(context.getSurfaceColor())
```

#### é›†ä¸­ç®¡ç†é¢œè‰²
```kotlin
// åˆ›å»ºé¢œè‰²ç®¡ç†ç±»
object ColorManager {
    fun getButtonColor(context: Context): Int {
        return context.getPrimaryColor()
    }
    
    fun getTextColor(context: Context, isPrimary: Boolean): Int {
        return if (isPrimary) {
            context.getTextPrimaryColor()
        } else {
            context.getTextSecondaryColor()
        }
    }
}
```

### 3. æ€§èƒ½ä¼˜åŒ–

#### ç¼“å­˜é¢œè‰²å€¼
```kotlin
class MyActivity : BaseActivity<ActivityMyBinding>() {
    private val primaryColor by lazy { getPrimaryColor() }
    private val textColor by lazy { getTextPrimaryColor() }
    
    override fun initView() {
        // ä½¿ç”¨ç¼“å­˜çš„é¢œè‰²å€¼
        binding.title.setTextColor(textColor)
        binding.button.setBackgroundColor(primaryColor)
    }
}
```

#### é¿å…é‡å¤è®¡ç®—
```kotlin
// âœ… æ¨èï¼šè®¡ç®—ä¸€æ¬¡ï¼Œå¤šæ¬¡ä½¿ç”¨
val primaryColor = context.getPrimaryColor()
button1.setBackgroundColor(primaryColor)
button2.setBackgroundColor(primaryColor)

// âŒ ä¸æ¨èï¼šé‡å¤è®¡ç®—
button1.setBackgroundColor(context.getPrimaryColor())
button2.setBackgroundColor(context.getPrimaryColor())
```

## ğŸ“± å®é™…åº”ç”¨ç¤ºä¾‹

### 1. åˆ›å»ºä¸»é¢˜åŒ–æŒ‰é’®

```xml
<!-- ä¸»æŒ‰é’® -->
<Button
    android:id="@+id/btnPrimary"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="ä¸»è¦æŒ‰é’®"
    android:textColor="?attr/colorOnPrimary"
    android:background="@drawable/bg_button_primary_pressed" />

<!-- æ¬¡æŒ‰é’® -->
<Button
    android:id="@+id/btnSecondary"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="æ¬¡è¦æŒ‰é’®"
    android:textColor="?attr/colorOnSecondary"
    android:background="@drawable/bg_secondary_rounded" />
```

### 2. åˆ›å»ºä¸»é¢˜åŒ–å¡ç‰‡

```xml
<androidx.cardview.CardView
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:background="?attr/colorSurface"
    app:cardCornerRadius="8dp"
    app:cardElevation="2dp">
    
    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="vertical"
        android:padding="16dp">
        
        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="å¡ç‰‡æ ‡é¢˜"
            android:textColor="?attr/textColorPrimary"
            android:textSize="16sp"
            android:textStyle="bold" />
        
        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_marginTop="8dp"
            android:text="å¡ç‰‡å†…å®¹"
            android:textColor="?attr/textColorSecondary"
            android:textSize="14sp" />
            
    </LinearLayout>
    
</androidx.cardview.CardView>
```

### 3. åˆ›å»ºä¸»é¢˜åŒ–è¾“å…¥æ¡†

```xml
<com.google.android.material.textfield.TextInputLayout
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:hint="è¯·è¾“å…¥å†…å®¹"
    app:boxBackgroundColor="?attr/colorSurface"
    app:hintTextColor="?attr/textColorSecondary">
    
    <com.google.android.material.textfield.TextInputEditText
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:textColor="?attr/textColorPrimary"
        android:textColorHint="?attr/textColorTertiary" />
        
</com.google.android.material.textfield.TextInputLayout>
```

## ğŸ”§ å¸¸è§é—®é¢˜è§£å†³

### 1. ä¸»é¢˜åˆ‡æ¢ä¸ç”Ÿæ•ˆ

**é—®é¢˜**: åˆ‡æ¢ä¸»é¢˜åç•Œé¢æ²¡æœ‰å˜åŒ–

**è§£å†³æ–¹æ¡ˆ**:
```kotlin
// ç¡®ä¿Activityç»§æ‰¿è‡ªBaseActivity
class MyActivity : BaseActivity<ActivityMyBinding>() {
    
    // ç¡®ä¿æ­£ç¡®æ³¨å…¥ThemeManager
    @Inject
    lateinit var injectedThemeManager: ThemeManager
    
    override fun initView() {
        super.themeManager = injectedThemeManager
        // å…¶ä»–ä»£ç ...
    }
}
```

### 2. é¢œè‰²è·å–å¤±è´¥

**é—®é¢˜**: è·å–ä¸»é¢˜é¢œè‰²æ—¶è¿”å›é»˜è®¤å€¼

**è§£å†³æ–¹æ¡ˆ**:
```kotlin
// æ£€æŸ¥ThemeManageræ˜¯å¦å·²åˆå§‹åŒ–
if (::themeManager.isInitialized) {
    val color = themeManager.getThemeColor(context, R.attr.colorPrimary)
} else {
    // ä½¿ç”¨é»˜è®¤é¢œè‰²
    val color = ContextCompat.getColor(context, android.R.color.white)
}
```

### 3. æš—é»‘æ¨¡å¼ä¸è·Ÿéšç³»ç»Ÿ

**é—®é¢˜**: è®¾ç½®è·Ÿéšç³»ç»Ÿåï¼Œæš—é»‘æ¨¡å¼æ²¡æœ‰è‡ªåŠ¨åˆ‡æ¢

**è§£å†³æ–¹æ¡ˆ**:
```kotlin
// ç¡®ä¿Activityé‡å†™äº†onConfigurationChanged
override fun onConfigurationChanged(newConfig: Configuration) {
    super.onConfigurationChanged(newConfig)
    
    // BaseActivityä¼šè‡ªåŠ¨å¤„ç†é…ç½®å˜åŒ–
    // å¦‚æœéœ€è¦è‡ªå®šä¹‰å¤„ç†ï¼Œå¯ä»¥é‡å†™æ­¤æ–¹æ³•
}
```

## ğŸ“š æ‰©å±•é˜…è¯»

### ç›¸å…³æ–‡æ¡£
- [ä¸»é¢˜ç³»ç»Ÿæ¶æ„æ–‡æ¡£](ä¸»é¢˜ç³»ç»Ÿæ¶æ„æ–‡æ¡£.md)
- [é¢œè‰²è§„èŒƒæ–‡æ¡£](é¢œè‰²è§„èŒƒæ–‡æ¡£.md)
- [Material Design 3 è§„èŒƒ](https://m3.material.io/)

### ç¤ºä¾‹ä»£ç 
- [ThemeSettingsActivity](../app/src/main/java/lj/sword/demoappnocompose/ui/settings/ThemeSettingsActivity.kt)
- [BaseActivity](../app/src/main/java/lj/sword/demoappnocompose/base/BaseActivity.kt)
- [ColorExt](../app/src/main/java/lj/sword/demoappnocompose/utils/ext/ColorExt.kt)

---

*æœ¬æ–‡æ¡£æœ€åæ›´æ–°æ—¶é—´: 2024å¹´10æœˆ*
